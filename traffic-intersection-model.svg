<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="463.6px" preserveAspectRatio="none" style="width:654px;height:463px;background:#FFFFFF;" version="1.1" viewBox="0 0 654 463" width="654.4px" zoomAndPan="magnify"><defs><filter height="300%" id="f1fmpzyjd3jmwq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="0.8000000000000002"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="1.6000000000000003" dy="1.6000000000000003" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[c317431f81cdf0e8053db5837ef6c822]
class TrafficLightStates--><rect codeLine="2" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="39.0781" id="TrafficLightStates" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="50.8" x="532.6" y="376.6"/><ellipse cx="538.6" cy="384.6375" fill="#EB937F" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M538,385.0375 L538,385.8375 L539.6,385.8375 L539.6,385.4375 L539.6,385.2438 L539.85,385.0375 L540,385.0375 L540.15,385.0375 L540.4,385.2438 L540.4,385.4375 L540.4,386.6375 L537.2,386.6375 L537.0063,386.6375 L536.8,386.3875 L536.8,386.2375 L536.8,386.0875 L537.0063,385.8375 L537.2,385.8375 L537.2,385.8375 L537.2,383.4375 L537.2,383.4375 L537.0063,383.4375 L536.8,383.1875 L536.8,383.0375 L536.8,382.8875 L537.0063,382.6375 L537.2,382.6375 L540.4,382.6375 L540.4,383.8375 L540.4,384.0313 L540.15,384.2375 L540,384.2375 L539.85,384.2375 L539.6,384.0313 L539.6,383.8375 L539.6,383.4375 L538,383.4375 L538,384.2375 L538.4,384.2375 L538.4,384.0438 L538.4,384.0438 L538.65,383.8375 L538.8,383.8375 L538.95,383.8375 L539.2,384.0438 L539.2,384.2375 L539.2,385.0375 L539.2,385.2313 L538.95,385.4375 L538.95,385.4375 L538.8,385.4375 L538.65,385.4375 L538.4,385.2313 L538.4,385.2313 L538.4,385.0375 L538,385.0375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="25.6" x="550.4" y="383.5828">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="4.8" lengthAdjust="spacing" textLength="38" x="544.2" y="389.6203">TrafficLightStates</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="533" x2="583" y1="392.675" y2="392.675"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="8" x="535" y="398.8426">RED</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="14.4" x="535" y="404.377">AMBER</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="13.6" x="535" y="409.9113">GREEN</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="533" x2="583" y1="412.4781" y2="412.4781"/><!--MD5=[082ea4b1b4c949e9e678c41ae71c099b]
class TrafficLightEvents--><rect codeLine="8" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="33.5438" id="TrafficLightEvents" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="51.6" x="597.4" y="379.4"/><ellipse cx="603.4" cy="387.4375" fill="#EB937F" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M602.8,387.8375 L602.8,388.6375 L604.4,388.6375 L604.4,388.2375 L604.4,388.0438 L604.65,387.8375 L604.8,387.8375 L604.95,387.8375 L605.2,388.0438 L605.2,388.2375 L605.2,389.4375 L602,389.4375 L601.8063,389.4375 L601.6,389.1875 L601.6,389.0375 L601.6,388.8875 L601.8063,388.6375 L602,388.6375 L602,388.6375 L602,386.2375 L602,386.2375 L601.8063,386.2375 L601.6,385.9875 L601.6,385.8375 L601.6,385.6875 L601.8063,385.4375 L602,385.4375 L605.2,385.4375 L605.2,386.6375 L605.2,386.8313 L604.95,387.0375 L604.8,387.0375 L604.65,387.0375 L604.4,386.8313 L604.4,386.6375 L604.4,386.2375 L602.8,386.2375 L602.8,387.0375 L603.2,387.0375 L603.2,386.8438 L603.2,386.8438 L603.45,386.6375 L603.6,386.6375 L603.75,386.6375 L604,386.8438 L604,387.0375 L604,387.8375 L604,388.0313 L603.75,388.2375 L603.75,388.2375 L603.6,388.2375 L603.45,388.2375 L603.2,388.0313 L603.2,388.0313 L603.2,387.8375 L602.8,387.8375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="27.2" x="614.8" y="386.3828">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="4.8" lengthAdjust="spacing" textLength="38.8" x="609" y="392.4203">TrafficLightEvents</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="597.8" x2="648.6" y1="395.475" y2="395.475"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="10.8" x="599.8" y="401.6426">STOP</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="6.4" x="599.8" y="407.177">GO</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="597.8" x2="648.6" y1="409.7438" y2="409.7438"/><!--MD5=[a261c3b0f6dc39c3323e9647de972898]
class TrafficLightContext--><rect codeLine="12" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="61.2156" id="TrafficLightContext" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="108" x="410.4" y="365.6"/><ellipse cx="442.3" cy="373.6375" fill="#B4A7E5" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M442.7,372.4375 L442.7,374.8375 L443.5,374.8375 L443.6938,374.8375 L443.9,375.0875 L443.9,375.2375 L443.9,375.3875 L443.6938,375.6375 L443.5,375.6375 L441.1,375.6375 L440.9063,375.6375 L440.7,375.3875 L440.7,375.2375 L440.7,375.0875 L440.9063,374.8375 L441.1,374.8375 L441.9,374.8375 L441.9,372.4375 L441.1,372.4375 L440.9063,372.4375 L440.7,372.1875 L440.7,372.0375 L440.7,371.8875 L440.9063,371.6375 L441.1,371.6375 L443.5,371.6375 L443.6938,371.6375 L443.9,371.8875 L443.9,372.0375 L443.9,372.1875 L443.6938,372.4375 L443.5,372.4375 L442.7,372.4375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="30.8" x="455.5" y="372.5828">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="40.8" x="450.5" y="378.6203">TrafficLightContext</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="410.8" x2="518" y1="381.675" y2="381.675"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="24" x="412.8" y="387.8426">name: String</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="38.8" x="412.8" y="393.377">amberTimeout: Long</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="410.8" x2="518" y1="395.9438" y2="395.9438"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="48" x="412.8" y="402.1113">setStopped() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="69.6" x="412.8" y="407.6457">switchRed(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="74.8" x="412.8" y="413.1801">switchAmber(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="74" x="412.8" y="418.7145">switchGreen(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="103.2" x="412.8" y="424.2488">stateChanged(toState: TrafficLightStates) «suspend»</text><!--MD5=[a5d8c30d72bb593ebcb9c3f9d7775a5d]
class TrafficLightEventHandler--><rect codeLine="22" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="52.4063" id="TrafficLightEventHandler" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="75.6" x="426.6" y="226.6"/><ellipse cx="436.56" cy="233" fill="#B4A7E5" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M436.96,231.8 L436.96,234.2 L437.76,234.2 L437.9538,234.2 L438.16,234.45 L438.16,234.6 L438.16,234.75 L437.9538,235 L437.76,235 L435.36,235 L435.1663,235 L434.96,234.75 L434.96,234.6 L434.96,234.45 L435.1663,234.2 L435.36,234.2 L436.16,234.2 L436.16,231.8 L435.36,231.8 L435.1663,231.8 L434.96,231.55 L434.96,231.4 L434.96,231.25 L435.1663,231 L435.36,231 L437.76,231 L437.9538,231 L438.16,231.25 L438.16,231.4 L438.16,231.55 L437.9538,231.8 L437.76,231.8 L436.96,231.8 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="54" x="443.04" y="234.9641">TrafficLightEventHandler</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="427" x2="501.8" y1="239.4" y2="239.4"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="54.4" x="429" y="245.5676">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="48.8" x="429" y="251.102">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="53.6" x="429" y="256.6363">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="56" x="429" y="262.1707">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="70.8" x="429" y="267.7051">state: StateFlow&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="427" x2="501.8" y1="270.2719" y2="270.2719"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="67.6" x="429" y="276.4395">changeAmberTimeout(value: Long)</text><!--MD5=[8f5d905706df63f012d7d74357fff60c]
class TrafficLightFSM--><rect codeLine="32" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="33.5438" id="TrafficLightFSM" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="47.2" x="525.2" y="236"/><ellipse cx="531.56" cy="244.0375" fill="#ADD1B2" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M532.36,242.6375 Q532.4413,242.4375 532.535,242.3375 Q532.6288,242.2375 532.735,242.2375 Q532.9225,242.2375 533.0413,242.35 Q533.16,242.4625 533.16,242.725 L533.16,243.35 Q533.16,243.6125 533.0475,243.725 Q532.935,243.8375 532.76,243.8375 Q532.6038,243.8375 532.5038,243.7688 Q532.4038,243.7 532.36,243.5188 Q532.3413,243.3938 532.2725,243.325 Q532.1475,243.1938 531.9225,243.1188 Q531.6975,243.0375 531.4725,243.0375 Q531.1913,243.0375 530.9538,243.15 Q530.7225,243.2625 530.5413,243.5125 Q530.36,243.7625 530.36,244.1063 L530.36,244.475 Q530.36,244.8875 530.6975,245.1625 Q531.035,245.4375 531.635,245.4375 Q531.9913,245.4375 532.2413,245.3563 Q532.385,245.3125 532.5475,245.1688 Q532.6538,245.0875 532.71,245.0625 Q532.7663,245.0375 532.835,245.0375 Q532.9663,245.0375 533.06,245.1438 Q533.16,245.2438 533.16,245.3875 Q533.16,245.525 533.0225,245.6875 Q532.8225,245.925 532.5038,246.0563 Q532.085,246.2375 531.5725,246.2375 Q530.9725,246.2375 530.4913,246 Q530.1038,245.8125 529.8288,245.4063 Q529.56,245 529.56,244.5188 L529.56,244.0813 Q529.56,243.5813 529.7975,243.1438 Q530.0413,242.7063 530.46,242.475 Q530.885,242.2375 531.36,242.2375 Q531.6475,242.2375 531.8975,242.3375 Q532.1475,242.4375 532.36,242.6375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="13.6" x="547.24" y="242.9828">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="4.8" lengthAdjust="spacing" textLength="33.6" x="537.24" y="249.0203">TrafficLightFSM</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="525.6" x2="572" y1="252.075" y2="252.075"/><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="525.6" x2="572" y1="255.275" y2="255.275"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="42.4" x="527.6" y="261.4426">fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="42" x="527.6" y="266.977">fun stop() «suspend»</text><!--MD5=[24d80c7a7824efcf0b8bd16fe5b50cae]
class TrafficLightService--><rect codeLine="41" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="66.75" id="TrafficLightService" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="158.8" x="427" y="53.8"/><ellipse cx="476.9" cy="61.8375" fill="#ADD1B2" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M477.7,60.4375 Q477.7813,60.2375 477.875,60.1375 Q477.9688,60.0375 478.075,60.0375 Q478.2625,60.0375 478.3813,60.15 Q478.5,60.2625 478.5,60.525 L478.5,61.15 Q478.5,61.4125 478.3875,61.525 Q478.275,61.6375 478.1,61.6375 Q477.9438,61.6375 477.8438,61.5688 Q477.7438,61.5 477.7,61.3188 Q477.6813,61.1938 477.6125,61.125 Q477.4875,60.9938 477.2625,60.9188 Q477.0375,60.8375 476.8125,60.8375 Q476.5313,60.8375 476.2938,60.95 Q476.0625,61.0625 475.8813,61.3125 Q475.7,61.5625 475.7,61.9063 L475.7,62.275 Q475.7,62.6875 476.0375,62.9625 Q476.375,63.2375 476.975,63.2375 Q477.3313,63.2375 477.5813,63.1563 Q477.725,63.1125 477.8875,62.9688 Q477.9938,62.8875 478.05,62.8625 Q478.1063,62.8375 478.175,62.8375 Q478.3063,62.8375 478.4,62.9438 Q478.5,63.0438 478.5,63.1875 Q478.5,63.325 478.3625,63.4875 Q478.1625,63.725 477.8438,63.8563 Q477.425,64.0375 476.9125,64.0375 Q476.3125,64.0375 475.8313,63.8 Q475.4438,63.6125 475.1688,63.2063 Q474.9,62.8 474.9,62.3188 L474.9,61.8813 Q474.9,61.3813 475.1375,60.9438 Q475.3813,60.5063 475.8,60.275 Q476.225,60.0375 476.7,60.0375 Q476.9875,60.0375 477.2375,60.1375 Q477.4875,60.2375 477.7,60.4375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="57.2" x="484.3" y="60.7828">«context-implementation»</text><text fill="#000000" font-family="sans-serif" font-size="4.8" lengthAdjust="spacing" textLength="40" x="492.9" y="66.8203">TrafficLightService</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="427.4" x2="585.4" y1="69.875" y2="69.875"/><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="427.4" x2="585.4" y1="73.075" y2="73.075"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="67.6" x="429.4" y="79.2426">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="89.6" x="429.4" y="84.777">setNotifyStopped(receiver: suspend () -&gt; Unit)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="154" x="429.4" y="90.3113">setNotifyStateChange(receiver: suspend (newState: TrafficLightStates) -&gt; Unit)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="41.6" x="429.4" y="95.8457">stopped() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="69.6" x="429.4" y="101.3801">switchRed(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="74.8" x="429.4" y="106.9145">switchAmber(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="74" x="429.4" y="112.4488">switchGreen(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="103.2" x="429.4" y="117.9832">stateChanged(toState: TrafficLightStates) «suspend»</text><!--MD5=[9749051c974da246c300c6b23f53e7a6]
class IntersectionStates--><rect codeLine="56" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="44.6125" id="IntersectionStates" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="52.4" x="276.6" y="373.8"/><ellipse cx="282.6" cy="381.8375" fill="#EB937F" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M282,382.2375 L282,383.0375 L283.6,383.0375 L283.6,382.6375 L283.6,382.4438 L283.85,382.2375 L284,382.2375 L284.15,382.2375 L284.4,382.4438 L284.4,382.6375 L284.4,383.8375 L281.2,383.8375 L281.0063,383.8375 L280.8,383.5875 L280.8,383.4375 L280.8,383.2875 L281.0063,383.0375 L281.2,383.0375 L281.2,383.0375 L281.2,380.6375 L281.2,380.6375 L281.0063,380.6375 L280.8,380.3875 L280.8,380.2375 L280.8,380.0875 L281.0063,379.8375 L281.2,379.8375 L284.4,379.8375 L284.4,381.0375 L284.4,381.2313 L284.15,381.4375 L284,381.4375 L283.85,381.4375 L283.6,381.2313 L283.6,381.0375 L283.6,380.6375 L282,380.6375 L282,381.4375 L282.4,381.4375 L282.4,381.2438 L282.4,381.2438 L282.65,381.0375 L282.8,381.0375 L282.95,381.0375 L283.2,381.2438 L283.2,381.4375 L283.2,382.2375 L283.2,382.4313 L282.95,382.6375 L282.95,382.6375 L282.8,382.6375 L282.65,382.6375 L282.4,382.4313 L282.4,382.4313 L282.4,382.2375 L282,382.2375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="25.6" x="295.2" y="380.7828">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="4.8" lengthAdjust="spacing" textLength="39.6" x="288.2" y="386.8203">IntersectionStates</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="277" x2="328.6" y1="389.875" y2="389.875"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="20" x="279" y="396.0426">STOPPING</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="17.2" x="279" y="401.577">WAITING</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="13.2" x="279" y="407.1113">GOING</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="18.4" x="279" y="412.6457">STOPPED</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="277" x2="328.6" y1="415.2125" y2="415.2125"/><!--MD5=[335fb609bd3f47ab478c9b95fb231727]
class IntersectionEvents--><rect codeLine="63" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="44.6125" id="IntersectionEvents" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="53.2" x="343" y="373.8"/><ellipse cx="349" cy="381.8375" fill="#EB937F" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M348.4,382.2375 L348.4,383.0375 L350,383.0375 L350,382.6375 L350,382.4438 L350.25,382.2375 L350.4,382.2375 L350.55,382.2375 L350.8,382.4438 L350.8,382.6375 L350.8,383.8375 L347.6,383.8375 L347.4063,383.8375 L347.2,383.5875 L347.2,383.4375 L347.2,383.2875 L347.4063,383.0375 L347.6,383.0375 L347.6,383.0375 L347.6,380.6375 L347.6,380.6375 L347.4063,380.6375 L347.2,380.3875 L347.2,380.2375 L347.2,380.0875 L347.4063,379.8375 L347.6,379.8375 L350.8,379.8375 L350.8,381.0375 L350.8,381.2313 L350.55,381.4375 L350.4,381.4375 L350.25,381.4375 L350,381.2313 L350,381.0375 L350,380.6375 L348.4,380.6375 L348.4,381.4375 L348.8,381.4375 L348.8,381.2438 L348.8,381.2438 L349.05,381.0375 L349.2,381.0375 L349.35,381.0375 L349.6,381.2438 L349.6,381.4375 L349.6,382.2375 L349.6,382.4313 L349.35,382.6375 L349.35,382.6375 L349.2,382.6375 L349.05,382.6375 L348.8,382.4313 L348.8,382.4313 L348.8,382.2375 L348.4,382.2375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="27.2" x="361.2" y="380.7828">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="4.8" lengthAdjust="spacing" textLength="40.4" x="354.6" y="386.8203">IntersectionEvents</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="343.4" x2="395.8" y1="389.875" y2="389.875"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="16.8" x="345.4" y="396.0426">SWITCH,</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="19.6" x="345.4" y="401.577">STOPPED,</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="12" x="345.4" y="407.1113">STOP,</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="13.6" x="345.4" y="412.6457">START</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="343.4" x2="395.8" y1="415.2125" y2="415.2125"/><!--MD5=[9868cacd5d1749ce2e997e727c15cdbd]
class TrafficIntersectionContext--><rect codeLine="70" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="61.2156" id="TrafficIntersectionContext" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="111.2" x="151.2" y="365.6"/><ellipse cx="177.3" cy="373.6375" fill="#B4A7E5" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M177.7,372.4375 L177.7,374.8375 L178.5,374.8375 L178.6938,374.8375 L178.9,375.0875 L178.9,375.2375 L178.9,375.3875 L178.6938,375.6375 L178.5,375.6375 L176.1,375.6375 L175.9063,375.6375 L175.7,375.3875 L175.7,375.2375 L175.7,375.0875 L175.9063,374.8375 L176.1,374.8375 L176.9,374.8375 L176.9,372.4375 L176.1,372.4375 L175.9063,372.4375 L175.7,372.1875 L175.7,372.0375 L175.7,371.8875 L175.9063,371.6375 L176.1,371.6375 L178.5,371.6375 L178.6938,371.6375 L178.9,371.8875 L178.9,372.0375 L178.9,372.1875 L178.6938,372.4375 L178.5,372.4375 L177.7,372.4375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="30.8" x="197.9" y="372.5828">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="55.6" x="185.5" y="378.6203">TrafficIntersectionContext</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="151.6" x2="262" y1="381.675" y2="381.675"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="38" x="153.6" y="387.8426">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="46.4" x="153.6" y="393.377">val cycleWaitTime: Long</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="151.6" x2="262" y1="395.9438" y2="395.9438"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="106.4" x="153.6" y="402.1113">suspend fun stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="60.4" x="153.6" y="407.6457">suspend fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="60" x="153.6" y="413.1801">suspend fun stop() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="60" x="153.6" y="418.7145">suspend fun next() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="57.2" x="153.6" y="424.2488">suspend fun off() «suspend»</text><!--MD5=[c56cb48cb5367e6a067e96aa34014d4b]
class TrafficIntersectionFSM--><rect codeLine="80" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="55.6813" id="TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="85.6" x="260" y="225"/><ellipse cx="276.98" cy="233.0375" fill="#ADD1B2" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M277.78,231.6375 Q277.8613,231.4375 277.955,231.3375 Q278.0488,231.2375 278.155,231.2375 Q278.3425,231.2375 278.4613,231.35 Q278.58,231.4625 278.58,231.725 L278.58,232.35 Q278.58,232.6125 278.4675,232.725 Q278.355,232.8375 278.18,232.8375 Q278.0238,232.8375 277.9238,232.7688 Q277.8238,232.7 277.78,232.5188 Q277.7613,232.3938 277.6925,232.325 Q277.5675,232.1938 277.3425,232.1188 Q277.1175,232.0375 276.8925,232.0375 Q276.6113,232.0375 276.3738,232.15 Q276.1425,232.2625 275.9613,232.5125 Q275.78,232.7625 275.78,233.1063 L275.78,233.475 Q275.78,233.8875 276.1175,234.1625 Q276.455,234.4375 277.055,234.4375 Q277.4113,234.4375 277.6613,234.3563 Q277.805,234.3125 277.9675,234.1688 Q278.0738,234.0875 278.13,234.0625 Q278.1863,234.0375 278.255,234.0375 Q278.3863,234.0375 278.48,234.1438 Q278.58,234.2438 278.58,234.3875 Q278.58,234.525 278.4425,234.6875 Q278.2425,234.925 277.9238,235.0563 Q277.505,235.2375 276.9925,235.2375 Q276.3925,235.2375 275.9113,235 Q275.5238,234.8125 275.2488,234.4063 Q274.98,234 274.98,233.5188 L274.98,233.0813 Q274.98,232.5813 275.2175,232.1438 Q275.4613,231.7063 275.88,231.475 Q276.305,231.2375 276.78,231.2375 Q277.0675,231.2375 277.3175,231.3375 Q277.5675,231.4375 277.78,231.6375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="13.6" x="302.42" y="231.9828">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="4.8" lengthAdjust="spacing" textLength="48.4" x="285.02" y="238.0203">TrafficIntersectionFSM</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="260.4" x2="345.2" y1="241.075" y2="241.075"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="61.2" x="262.4" y="247.2426">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="260.4" x2="345.2" y1="249.8094" y2="249.8094"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="80.8" x="262.4" y="255.977">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="57.2" x="262.4" y="261.5113">startIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="56.8" x="262.4" y="267.0457">stopIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="61.6" x="262.4" y="272.5801">switchIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="41.6" x="262.4" y="278.1145">stopped() «suspend»</text><!--MD5=[7edde04eb472bac7a7abbff093a59d44]
class TrafficIntersectionEventHandler--><rect codeLine="93" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="124.3531" id="TrafficIntersectionEventHandler" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="134.4" x="2.8" y="334"/><ellipse cx="33.9" cy="340.4" fill="#B4A7E5" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M34.3,339.2 L34.3,341.6 L35.1,341.6 L35.2938,341.6 L35.5,341.85 L35.5,342 L35.5,342.15 L35.2938,342.4 L35.1,342.4 L32.7,342.4 L32.5063,342.4 L32.3,342.15 L32.3,342 L32.3,341.85 L32.5063,341.6 L32.7,341.6 L33.5,341.6 L33.5,339.2 L32.7,339.2 L32.5063,339.2 L32.3,338.95 L32.3,338.8 L32.3,338.65 L32.5063,338.4 L32.7,338.4 L35.1,338.4 L35.2938,338.4 L35.5,338.65 L35.5,338.8 L35.5,338.95 L35.2938,339.2 L35.1,339.2 L34.3,339.2 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="68.8" x="42.1" y="342.3641">TrafficIntersectionEventHandler</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="3.2" x2="136.8" y1="346.8" y2="346.8"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="38.8" x="5.2" y="352.9676">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="71.2" x="5.2" y="358.502">state: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="56" x="5.2" y="364.0363">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="38.4" x="5.2" y="369.5707">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="53.2" x="5.2" y="375.1051">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="41.6" x="5.2" y="380.6395">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="84.8" x="5.2" y="386.1738">trafficLights: List&lt;TrafficLightEventHandler&gt;</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="3.2" x2="136.8" y1="388.7406" y2="388.7406"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="83.2" x="5.2" y="394.9082">get(name: String): TrafficLightEventHandler</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="59.6" x="5.2" y="400.4426">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="68" x="5.2" y="405.977">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="67.6" x="5.2" y="411.5113">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="129.6" x="5.2" y="417.0457">addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="80.8" x="5.2" y="422.5801">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="36.4" x="5.2" y="428.1145">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="18.8" x="5.2" y="433.6488">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="58" x="5.2" y="439.1832">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="26.4" x="5.2" y="444.7176">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="26" x="5.2" y="450.252">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="16.4" x="5.2" y="455.7863">switch()</text><!--MD5=[09381f51bdf889138526ece6de7cd791]
class TrafficIntersectionService--><rect codeLine="117" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="168.6281" id="TrafficIntersectionService" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="134.4" x="235.6" y="2.8"/><ellipse cx="273.7" cy="9.2" fill="#ADD1B2" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M274.5,7.8 Q274.5813,7.6 274.675,7.5 Q274.7688,7.4 274.875,7.4 Q275.0625,7.4 275.1813,7.5125 Q275.3,7.625 275.3,7.8875 L275.3,8.5125 Q275.3,8.775 275.1875,8.8875 Q275.075,9 274.9,9 Q274.7438,9 274.6438,8.9313 Q274.5438,8.8625 274.5,8.6813 Q274.4813,8.5563 274.4125,8.4875 Q274.2875,8.3563 274.0625,8.2813 Q273.8375,8.2 273.6125,8.2 Q273.3313,8.2 273.0938,8.3125 Q272.8625,8.425 272.6813,8.675 Q272.5,8.925 272.5,9.2688 L272.5,9.6375 Q272.5,10.05 272.8375,10.325 Q273.175,10.6 273.775,10.6 Q274.1313,10.6 274.3813,10.5188 Q274.525,10.475 274.6875,10.3313 Q274.7938,10.25 274.85,10.225 Q274.9063,10.2 274.975,10.2 Q275.1063,10.2 275.2,10.3063 Q275.3,10.4063 275.3,10.55 Q275.3,10.6875 275.1625,10.85 Q274.9625,11.0875 274.6438,11.2188 Q274.225,11.4 273.7125,11.4 Q273.1125,11.4 272.6313,11.1625 Q272.2438,10.975 271.9688,10.5688 Q271.7,10.1625 271.7,9.6813 L271.7,9.2438 Q271.7,8.7438 271.9375,8.3063 Q272.1813,7.8688 272.6,7.6375 Q273.025,7.4 273.5,7.4 Q273.7875,7.4 274.0375,7.5 Q274.2875,7.6 274.5,7.8 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" lengthAdjust="spacing" textLength="54.8" x="281.9" y="11.1641">TrafficIntersectionService</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="236" x2="369.6" y1="15.6" y2="15.6"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="71.2" x="238" y="21.7676">state: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="56" x="238" y="27.302">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="38.8" x="238" y="32.8363">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="41.6" x="238" y="38.3707">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="84.8" x="238" y="43.9051">trafficLights: List&lt;TrafficLightEventHandler&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="31.2" x="238" y="49.4395">cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="38.4" x="238" y="54.9738">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="53.2" x="238" y="60.5082">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="39.6" x="238" y="66.0426">cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="61.2" x="238" y="71.577">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="236" x2="369.6" y1="74.1438" y2="74.1438"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="67.6" x="238" y="80.3113">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="36.4" x="238" y="85.8457">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="83.2" x="238" y="91.3801">get(name: String): TrafficLightEventHandler</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="129.6" x="238" y="96.9145">addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="58" x="238" y="102.4488">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="80.8" x="238" y="107.9832">stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="59.6" x="238" y="113.5176">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="68" x="238" y="119.052">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="12" x="238" y="124.5863">start()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="11.6" x="238" y="130.1207">stop()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="8.8" x="238" y="135.6551">off()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="11.6" x="238" y="141.1895">next()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="26.4" x="238" y="146.7238">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="26" x="238" y="152.2582">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="16.4" x="238" y="157.7926">switch()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="18.8" x="238" y="163.327">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="80.8" x="238" y="168.8613">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><!--MD5=[ce902affe73128e0a9c1460ddb6351ac]
class TrafficIntersectionViewModel--><rect codeLine="151" fill="#90EE90" filter="url(#f1fmpzyjd3jmwq)" height="99.9563" id="TrafficIntersectionViewModel" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="105.6" x="17.2" y="202.8"/><ellipse cx="37.1" cy="210.8375" fill="#ADD1B2" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M37.9,209.4375 Q37.9813,209.2375 38.075,209.1375 Q38.1688,209.0375 38.275,209.0375 Q38.4625,209.0375 38.5813,209.15 Q38.7,209.2625 38.7,209.525 L38.7,210.15 Q38.7,210.4125 38.5875,210.525 Q38.475,210.6375 38.3,210.6375 Q38.1438,210.6375 38.0438,210.5688 Q37.9438,210.5 37.9,210.3188 Q37.8813,210.1938 37.8125,210.125 Q37.6875,209.9938 37.4625,209.9188 Q37.2375,209.8375 37.0125,209.8375 Q36.7313,209.8375 36.4938,209.95 Q36.2625,210.0625 36.0813,210.3125 Q35.9,210.5625 35.9,210.9063 L35.9,211.275 Q35.9,211.6875 36.2375,211.9625 Q36.575,212.2375 37.175,212.2375 Q37.5313,212.2375 37.7813,212.1563 Q37.925,212.1125 38.0875,211.9688 Q38.1938,211.8875 38.25,211.8625 Q38.3063,211.8375 38.375,211.8375 Q38.5063,211.8375 38.6,211.9438 Q38.7,212.0438 38.7,212.1875 Q38.7,212.325 38.5625,212.4875 Q38.3625,212.725 38.0438,212.8563 Q37.625,213.0375 37.1125,213.0375 Q36.5125,213.0375 36.0313,212.8 Q35.6438,212.6125 35.3688,212.2063 Q35.1,211.8 35.1,211.3188 L35.1,210.8813 Q35.1,210.3813 35.3375,209.9438 Q35.5813,209.5063 36,209.275 Q36.425,209.0375 36.9,209.0375 Q37.1875,209.0375 37.4375,209.1375 Q37.6875,209.2375 37.9,209.4375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="29.2" x="61.9" y="209.7828">«viewmodel»</text><text fill="#000000" font-family="sans-serif" font-size="4.8" lengthAdjust="spacing" textLength="62.4" x="45.3" y="215.8203">TrafficIntersectionViewModel</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="17.6" x2="122.4" y1="218.875" y2="218.875"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="45.6" x="19.6" y="225.0426">val amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="46.4" x="19.6" y="230.577">val cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="38" x="19.6" y="236.1113">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="45.2" x="19.6" y="241.6457">val currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="91.6" x="19.6" y="247.1801">val trafficLights: List&lt;TrafficLightEventHandler&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="0" x="20.8" y="252.7145"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="100.8" x="19.6" y="258.2488">val intersectionState: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="68.8" x="19.6" y="263.7832">val allowStart: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="73.2" x="19.6" y="269.3176">val allowSwitch: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="68.4" x="19.6" y="274.852">val allowStop: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="91.6" x="19.6" y="280.3863">val trafficLights: List&lt;TrafficLightEventHandler&gt;</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="17.6" x2="122.4" y1="282.9531" y2="282.9531"/><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="49.2" x="19.6" y="289.1207">startSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="48.8" x="19.6" y="294.6551">stopSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="4.4" lengthAdjust="spacing" textLength="39.2" x="19.6" y="300.1895">switch() «suspend»</text><!--MD5=[b1d46488418bc0cd55cf54b5fc017696]
class ViewModel--><rect codeLine="171" fill="#008000" filter="url(#f1fmpzyjd3jmwq)" height="22.475" id="ViewModel" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="36.4" x="51.8" y="76"/><ellipse cx="57.8" cy="84.0375" fill="#ADD1B2" rx="4.4" ry="4.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><path d="M58.6,82.6375 Q58.6813,82.4375 58.775,82.3375 Q58.8688,82.2375 58.975,82.2375 Q59.1625,82.2375 59.2813,82.35 Q59.4,82.4625 59.4,82.725 L59.4,83.35 Q59.4,83.6125 59.2875,83.725 Q59.175,83.8375 59,83.8375 Q58.8438,83.8375 58.7438,83.7688 Q58.6438,83.7 58.6,83.5188 Q58.5813,83.3938 58.5125,83.325 Q58.3875,83.1938 58.1625,83.1188 Q57.9375,83.0375 57.7125,83.0375 Q57.4313,83.0375 57.1938,83.15 Q56.9625,83.2625 56.7813,83.5125 Q56.6,83.7625 56.6,84.1063 L56.6,84.475 Q56.6,84.8875 56.9375,85.1625 Q57.275,85.4375 57.875,85.4375 Q58.2313,85.4375 58.4813,85.3563 Q58.625,85.3125 58.7875,85.1688 Q58.8938,85.0875 58.95,85.0625 Q59.0063,85.0375 59.075,85.0375 Q59.2063,85.0375 59.3,85.1438 Q59.4,85.2438 59.4,85.3875 Q59.4,85.525 59.2625,85.6875 Q59.0625,85.925 58.7438,86.0563 Q58.325,86.2375 57.8125,86.2375 Q57.2125,86.2375 56.7313,86 Q56.3438,85.8125 56.0688,85.4063 Q55.8,85 55.8,84.5188 L55.8,84.0813 Q55.8,83.5813 56.0375,83.1438 Q56.2813,82.7063 56.7,82.475 Q57.125,82.2375 57.6,82.2375 Q57.8875,82.2375 58.1375,82.3375 Q58.3875,82.4375 58.6,82.6375 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="4.8" font-style="italic" lengthAdjust="spacing" textLength="22.4" x="64" y="82.9828">«android»</text><text fill="#000000" font-family="sans-serif" font-size="4.8" lengthAdjust="spacing" textLength="23.6" x="63.4" y="89.0203">ViewModel</text><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="52.2" x2="87.8" y1="92.075" y2="92.075"/><line style="stroke:#A80036;stroke-width:0.6000000000000001;" x1="52.2" x2="87.8" y1="95.275" y2="95.275"/><!--MD5=[8d736074daedf82f88efcc1957014a1f]
link TrafficLightEventHandler to TrafficLightContext--><path codeLine="30" d="M464.4,279.0236 C464.4,300.9088 464.4,332.6048 464.4,357.454 " fill="none" id="TrafficLightEventHandler-to-TrafficLightContext" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><polygon fill="none" points="467.2,357.5948,464.4,365.5948,461.6,357.5948,467.2,357.5948" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><!--MD5=[f5a4d25a21e2db1a9bef5b5bdfa80daf]
link TrafficLightFSM to TrafficLightStates--><path codeLine="37" d="M549.864,269.6972 C551.536,295.6148 554.78,345.86 556.624,374.4824 " fill="none" id="TrafficLightFSM-to-TrafficLightStates" style="stroke:#A80036;stroke-width:0.4000000000000001;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="556.756,376.5052,558.1211,372.8097,556.6273,374.5093,554.9277,373.0156,556.756,376.5052" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="16.8" x="553.2" y="320.598">«uses»</text><!--MD5=[ef55fa34c35daebc710b7e66915eb99f]
link TrafficLightFSM to TrafficLightEvents--><path codeLine="38" d="M557.408,269.6972 C571.424,296.5636 599.08,349.5704 613.672,377.536 " fill="none" id="TrafficLightFSM-to-TrafficLightEvents" style="stroke:#A80036;stroke-width:0.4000000000000001;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="614.612,379.3412,614.3637,375.4095,613.6861,377.5684,611.5272,376.8909,614.612,379.3412" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="16.8" x="584" y="320.598">«uses»</text><!--MD5=[7d975c74983153482517d07fdba291a6]
link TrafficLightFSM to TrafficLightContext--><path codeLine="39" d="M539.036,269.6972 C525.464,292.6276 500.62,334.6008 483.344,363.794 " fill="none" id="TrafficLightFSM-to-TrafficLightContext" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><polygon fill="#A80036" points="482.32,365.5232,485.5308,363.2405,483.3389,363.8022,482.7772,361.6103,482.32,365.5232" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="17.2" x="512" y="320.598">context</text><!--MD5=[f2d21969ec6ca24805aa2b6c8aba1483]
link TrafficLightService to TrafficLightEventHandler--><path codeLine="52" d="M497.952,120.7516 C490.696,149.2144 480.288,190.0604 472.992,218.6852 " fill="none" id="TrafficLightService-to-TrafficLightEventHandler" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><polygon fill="none" points="475.664,219.5368,470.976,226.5976,470.24,218.154,475.664,219.5368" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><!--MD5=[b02eea57f08a8734f953d301797f548e]
link TrafficLightService to TrafficLightFSM--><path codeLine="53" d="M516.1242,125.4002 C516.1242,125.4002 536.436,204.3428 543.276,230.9356 " fill="none" id="TrafficLightService-TrafficLightFSM" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><polygon fill="#A80036" points="544.576,235.9884,545.2284,232.1033,544.0776,234.0515,542.1293,232.9007,544.576,235.9884" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><line style="stroke:#A80036;stroke-width:0.4000000000000001;" x1="544.0776" x2="543.282" y1="234.0515" y2="230.9526"/><polygon fill="#A80036" points="514.928,120.7516,513.9766,123.4746,516.1242,125.4002,517.0756,122.6772,514.928,120.7516" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><!--MD5=[02c58767cbaebf5fe961d047052ec028]
link TrafficIntersectionFSM to TrafficIntersectionContext--><path codeLine="89" d="M284.2904,280.6948 C268.3012,304.4452 245.1844,338.7832 228.3628,363.77 " fill="none" id="TrafficIntersectionFSM-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><polygon fill="#A80036" points="227.1628,365.5528,230.5008,363.4605,228.28,363.8939,227.8466,361.6731,227.1628,365.5528" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="17.2" x="261.2" y="320.598">context</text><!--MD5=[9468340d7453291c53dc9c139c20e995]
link TrafficIntersectionFSM to IntersectionEvents--><path codeLine="90" d="M320.6772,280.6604 C327.0868,291.114 334.0852,303.2836 339.6,314.8 C348.5,333.3856 356.4892,355.3568 361.9812,371.724 " fill="none" id="TrafficIntersectionFSM-to-IntersectionEvents" style="stroke:#A80036;stroke-width:0.4000000000000001;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="362.6384,373.6916,363.0154,369.7701,362.0047,371.7946,359.9802,370.784,362.6384,373.6916" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="33.2" x="343.2" y="320.598">events «uses»</text><!--MD5=[fe4ec4b482b722450bc85149b58e4a7c]
link TrafficIntersectionFSM to IntersectionStates--><path codeLine="91" d="M302.8,280.6948 C302.8,307.066 302.8,346.4908 302.8,371.6736 " fill="none" id="TrafficIntersectionFSM-to-IntersectionStates" style="stroke:#A80036;stroke-width:0.4000000000000001;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="302.8,373.7632,304.4,370.1632,302.8,371.7632,301.2,370.1632,302.8,373.7632" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="32.8" x="303.2" y="320.598">states «uses»</text><!--MD5=[bf504e590ef5f0ed45f1c6c906ad0fbf]
link TrafficIntersectionEventHandler to TrafficIntersectionContext--><path codeLine="115" d="M137.3312,396.2 C139.2776,396.2 141.2236,396.2 143.1696,396.2 " fill="none" id="TrafficIntersectionEventHandler-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><polygon fill="none" points="143.1708,393.4,151.1708,396.2,143.1708,399,143.1708,393.4" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><!--MD5=[7b984e9d12bd2ad1569c6c891f886256]
link TrafficIntersectionService to TrafficIntersectionEventHandler--><path codeLine="147" d="M239.34,171.6132 C202.3396,220.5976 156.2708,281.5876 121.5288,327.582 " fill="none" id="TrafficIntersectionService-to-TrafficIntersectionEventHandler" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><polygon fill="none" points="123.76,329.2736,116.704,333.9696,119.2916,325.8984,123.76,329.2736" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><!--MD5=[a0c4c6e1b7e6bd88c7aa08379bf65076]
link TrafficIntersectionService to TrafficIntersectionFSM--><path codeLine="148" d="M302.8,176.4896 C302.8,176.4896 302.8,207.2256 302.8,219.736 " fill="none" id="TrafficIntersectionService-TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><polygon fill="#A80036" points="302.8,224.942,304.4,221.342,302.8,222.942,301.2,221.342,302.8,224.942" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><line style="stroke:#A80036;stroke-width:0.4000000000000001;" x1="302.8" x2="302.8" y1="222.942" y2="219.742"/><polygon fill="#A80036" points="302.8,171.6896,301.2,174.0896,302.8,176.4896,304.4,174.0896,302.8,171.6896" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="60" x="303.2" y="189.398">intersectionFSM «private»</text><!--MD5=[f96f6775ec67c35e7f6bb021a13357d7]
link TrafficIntersectionService to TrafficLightEventHandler--><path codeLine="149" d="M370.046,156.1776 C393.8216,180.424 419.208,206.314 437.656,225.1244 " fill="none" id="TrafficIntersectionService-to-TrafficLightEventHandler" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><polygon fill="#A80036" points="439.08,226.58,437.703,222.8889,437.6801,225.1516,435.4175,225.1287,439.08,226.58" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="48.4" x="403.6" y="189.398">trafficLights «private»</text><!--MD5=[642468606f4d2d9c0bbf80f925485bcd]
link TrafficIntersectionViewModel to TrafficIntersectionEventHandler--><path codeLine="169" d="M70,302.8744 C70,312.2172 70,322.1068 70,331.814 " fill="none" id="TrafficIntersectionViewModel-to-TrafficIntersectionEventHandler" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><polygon fill="#A80036" points="70,333.8824,71.6,330.2824,70,331.8824,68.4,330.2824,70,333.8824" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="39.2" x="70.4" y="320.598">trafficIntersection</text><!--MD5=[098a41ab95969f63653f37d909efe300]
reverse link ViewModel to TrafficIntersectionViewModel--><path codeLine="170" d="M70,106.4448 C70,129.7432 70,170.2912 70,202.7452 " fill="none" id="ViewModel-backto-TrafficIntersectionViewModel" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><polygon fill="none" points="67.2,106.4132,70,98.4128,72.8,106.4128,67.2,106.4132" style="stroke:#A80036;stroke-width:0.4000000000000001;"/><!--MD5=[84a648d853ca3d95f70b086ee087aa0d]
@startuml

enum TrafficLightStates <<fsm-state>> {
    RED
    AMBER
    GREEN
}

enum TrafficLightEvents <<fsm-event>> {
    STOP
    GO
}
interface TrafficLightContext <<fsm-context>> {
    name: String
    amberTimeout: Long
    setStopped() <<suspend>>
    switchRed(on: Boolean) <<suspend>>
    switchAmber(on: Boolean) <<suspend>>
    switchGreen(on: Boolean) <<suspend>>
    stateChanged(toState: TrafficLightStates) <<suspend>>
}

interface TrafficLightEventHandler {
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: SharedFlow<Long>
    state: StateFlow<TrafficLightStates>
    changeAmberTimeout(value: Long)
}
TrafficLightEventHandler -|> TrafficLightContext

class TrafficLightFSM <<fsm>> {
    fun start() <<suspend>>
    fun stop() <<suspend>>
}

TrafficLightFSM ..> TrafficLightStates: <<uses>>
TrafficLightFSM ..> TrafficLightEvents: <<uses>>
TrafficLightFSM - -> TrafficLightContext: context

class TrafficLightService <<context-implementation>> {
    changeAmberTimeout(value: Long)
    setNotifyStopped(receiver: suspend () -> Unit)
    setNotifyStateChange(receiver: suspend (newState: TrafficLightStates) -> Unit)
    stopped() <<suspend>>
    switchRed(on: Boolean) <<suspend>>
    switchAmber(on: Boolean) <<suspend>>
    switchGreen(on: Boolean) <<suspend>>
    stateChanged(toState: TrafficLightStates) <<suspend>>
}

TrafficLightService - -|> TrafficLightEventHandler
TrafficLightService *- -> TrafficLightFSM


enum IntersectionStates <<fsm-state>> {
    STOPPING
    WAITING
    GOING
    STOPPED
}

enum IntersectionEvents <<fsm-event>> {
    SWITCH,
    STOPPED,
    STOP,
    START
}

interface TrafficIntersectionContext <<fsm-context>> {
    val cycleTime: Long
    val cycleWaitTime: Long
    suspend fun stateChanged(toState: IntersectionStates)
    suspend fun start() <<suspend>>
    suspend fun stop() <<suspend>>
    suspend fun next() <<suspend>>
    suspend fun off() <<suspend>>
}

class TrafficIntersectionFSM <<fsm>> {
    currentState: IntersectionStates
    allowedEvents(): Set<IntersectionEvents>
    startIntersection() <<suspend>>
    stopIntersection() <<suspend>>
    switchIntersection() <<suspend>>
    stopped() <<suspend>>
}

TrafficIntersectionFSM - -> TrafficIntersectionContext: context
TrafficIntersectionFSM ..> IntersectionEvents: events <<uses>>
TrafficIntersectionFSM ..> IntersectionStates: states <<uses>>

interface TrafficIntersectionEventHandler {
    amberTimeout: Long
    state: StateFlow<IntersectionStates>
    stopped: SharedFlow<Long>
    currentName: String
    current: TrafficLightContext
    listOrder: List<String>
    trafficLights: List<TrafficLightEventHandler>
    get(name: String): TrafficLightEventHandler
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    changeAmberTimeout(value: Long)
    addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)
    allowedEvents(): Set<IntersectionEvents>
    setupIntersection()
    stopped()
    startTrafficLight(name: String)
    startSystem()
    stopSystem()
    switch()
}

TrafficIntersectionEventHandler -|> TrafficIntersectionContext

class TrafficIntersectionService {
    state: StateFlow<IntersectionStates>
    stopped: SharedFlow<Long>
    amberTimeout: Long
    changeAmberTimeout(value: Long)
    setupIntersection()
    listOrder: List<String>
    trafficLights: List<TrafficLightEventHandler>
    cycleTime: Long
        currentName: String
        current: TrafficLightContext
        cycleWaitTime: Long
        currentState: IntersectionStates
    get(name: String): TrafficLightEventHandler
    addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)
    startTrafficLight(name: String)
    stateChanged(toState: IntersectionStates)
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    start()
    stop()
    off()
    next()
    startSystem()
    stopSystem()
    switch()
    stopped()
    allowedEvents(): Set<IntersectionEvents>
}

TrafficIntersectionService - -|> TrafficIntersectionEventHandler
TrafficIntersectionService *- -> TrafficIntersectionFSM: intersectionFSM <<private>>
TrafficIntersectionService - -> TrafficLightEventHandler: trafficLights <<private>>

class TrafficIntersectionViewModel <<viewmodel>> #lightgreen {
    val amberTimeout: Long
    val cycleWaitTime: Long
    val cycleTime: Long
    val currentName: String
    val trafficLights: List<TrafficLightEventHandler>

    val intersectionState: StateFlow<IntersectionStates>
    val allowStart: StateFlow<Boolean>
    val allowSwitch: StateFlow<Boolean>
    val allowStop: StateFlow<Boolean>
    val trafficLights: List<TrafficLightEventHandler>

    startSystem() <<suspend>>
    stopSystem() <<suspend>>
    switch() <<suspend>>
}

TrafficIntersectionViewModel - -> TrafficIntersectionEventHandler: trafficIntersection
TrafficIntersectionViewModel -up-|> ViewModel
class ViewModel <<android>> #green {
}

@enduml

PlantUML version 1.2021.7(Sun May 23 14:40:07 CAT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>